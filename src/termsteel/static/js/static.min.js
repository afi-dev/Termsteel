/*!
 * Termsteel V.0.0.1
 * (c) 2022 Afi
 * Released under the CC BY-NC-SA 3.0 Attribution-NonCommercial-ShareAlike 3.0 License.
 */
const mengcontext = document.getElementById("contextmenu");
let isVisible = !1;
const contextToggle = e => {
    mengcontext.style.display = e ? "block" : "none"
};

function exitcontextmenu() {
    contextToggle(isVisible = !1)
}
terminal.addEventListener("contextmenu", function(e) {
    return e.preventDefault(), isVisible = !0, mengcontext.style.top = `${e.pageY}px`, mengcontext.style.left = `${e.pageX}px`, contextToggle(!0), !1
});
const term = new Terminal({
        cursorBlink: !0,
        allowTransparency: !0,
        macOptionIsMeta: !0,
        theme: {
            foreground: "#EEEEEE",
            background: "#12121280",
            cursor: "#ffffff"
        }
    }),
    fit = new FitAddon.FitAddon;
term.loadAddon(fit), term.loadAddon(new WebLinksAddon.WebLinksAddon), term.loadAddon(new SearchAddon.SearchAddon), term.loadAddon(new Unicode11Addon.Unicode11Addon), term.loadAddon(new Unicode11Addon.Unicode11Addon), term.open(document.getElementById("terminal")), fit.fit(), term.resize(15, 50), console.log(`size: ${term.cols} columns, ${term.rows} rows`), fit.fit(), term.onData(e => {
    console.log("send:", e), socket.emit("pty-input", {
        input: e
    })
}), term.unicode.activeVersion = "11", term.attachCustomKeyEventHandler(e => e.ctrlKey && "KeyC" === e.code && "keydown" === e.type && term.getSelection() ? (document.execCommand("copy"), document.getElementById("alert").style.display = "block", document.getElementById("alert-content").innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="termsteel-flex-shrink-0 termsteel-w-5 termsteel-h-5 termsteel-mr-3 -termsteel-ml-1 termsteel-fill-white " viewBox="0 0 512 512"> <path xmlns="http://www.w3.org/2000/svg" d="M408 480H184a72 72 0 01-72-72V184a72 72 0 0172-72h224a72 72 0 0172 72v224a72 72 0 01-72 72z"></path> <path xmlns="http://www.w3.org/2000/svg" d="M160 80h235.88A72.12 72.12 0 00328 32H104a72 72 0 00-72 72v224a72.12 72.12 0 0048 67.88V160a80 80 0 0180-80z"></path> </svg> <span class="termsteel-truncate termsteel-text-white"> <trad x-show="languages===\'en\'">Copy successful </trad> <trad x-show="languages===\'fr\'">Copie réussie </trad> <trad x-show="languages===\'de\'">Erfolgreiche Kopie </trad> <trad x-show="languages===\'es\'">Copia exitosa </trad> </span>', setTimeout(() => {
    document.getElementById("alert").style.display = "none"
}, 1e3), !1) : (e.ctrlKey && "KeyV" === e.code && "keydown" === e.type && navigator.clipboard.readText().then(e => {
    term.write(e)
}), e.ctrlKey && "Enter" === e.code && "keydown" === e.type && (document.getElementById("alert").style.display = "block", document.getElementById("alert-content").innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="termsteel-flex-shrink-0 termsteel-w-5 termsteel-h-5 termsteel-mr-3 -termsteel-ml-1 termsteel-fill-white " viewBox="0 0 512 512"> <path xmlns="http://www.w3.org/2000/svg" d="M74.45 160a8 8 0 00-8 8.83l26.31 252.56a1.5 1.5 0 000 .22A48 48 0 00140.45 464h231.09a48 48 0 0047.67-42.39v-.21l26.27-252.57a8 8 0 00-8-8.83zm248.86 180.69a16 16 0 11-22.63 22.62L256 318.63l-44.69 44.68a16 16 0 01-22.63-22.62L233.37 296l-44.69-44.69a16 16 0 0122.63-22.62L256 273.37l44.68-44.68a16 16 0 0122.63 22.62L278.62 296z"/><rect xmlns="http://www.w3.org/2000/svg" x="32" y="48" width="448" height="80" rx="32" ry="32"/> </svg> <span class="termsteel-truncate termsteel-text-white"> <trad x-show="languages===\'en\'">Terminal has been clear</trad> <trad x-show="languages===\'fr\'">Terminal effacer </trad> <trad x-show="languages===\'de\'">Terminal wurde gelöscht </trad> <trad x-show="languages===\'es\'">Terminal ha sido eliminado</trad> </span>', setTimeout(() => {
    document.getElementById("alert").style.display = "none"
}, 1e3), term.clear(), term.write(data.output)), !0)), window.onmousedown = (e => {
    const t = term.getSelection();
    1 === e.button && t && (document.execCommand("copy"), document.getElementById("alert").style.display = "block", document.getElementById("alert-content").innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="termsteel-flex-shrink-0 termsteel-w-5 termsteel-h-5 termsteel-mr-3 -termsteel-ml-1 termsteel-fill-white " viewBox="0 0 512 512"> <path xmlns="http://www.w3.org/2000/svg" d="M408 480H184a72 72 0 01-72-72V184a72 72 0 0172-72h224a72 72 0 0172 72v224a72 72 0 01-72 72z"></path> <path xmlns="http://www.w3.org/2000/svg" d="M160 80h235.88A72.12 72.12 0 00328 32H104a72 72 0 00-72 72v224a72.12 72.12 0 0048 67.88V160a80 80 0 0180-80z"></path> </svg> <span class="termsteel-truncate termsteel-text-white"> <trad x-show="languages===\'en\'">Copy successful </trad> <trad x-show="languages===\'fr\'">Copie réussie </trad> <trad x-show="languages===\'de\'">Erfolgreiche Kopie </trad> <trad x-show="languages===\'es\'">Copia exitosa </trad> </span>', setTimeout(() => {
        document.getElementById("alert").style.display = "none"
    }, 1e3))
});
const copybtn = document.getElementById("copy-btn");
copybtn.onclick = function() {
    if (term.getSelection()) return document.execCommand("Copy"), document.getElementById("alert").style.display = "block", document.getElementById("alert-content").innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="termsteel-flex-shrink-0 termsteel-w-5 termsteel-h-5 termsteel-mr-3 -termsteel-ml-1 termsteel-fill-white " viewBox="0 0 512 512"> <path xmlns="http://www.w3.org/2000/svg" d="M408 480H184a72 72 0 01-72-72V184a72 72 0 0172-72h224a72 72 0 0172 72v224a72 72 0 01-72 72z"></path> <path xmlns="http://www.w3.org/2000/svg" d="M160 80h235.88A72.12 72.12 0 00328 32H104a72 72 0 00-72 72v224a72.12 72.12 0 0048 67.88V160a80 80 0 0180-80z"></path> </svg> <span class="truncate text-white"> <trad x-show="languages===\'en\'">Copy successful </trad> <trad x-show="languages===\'fr\'">Copie réussie </trad> <trad x-show="languages===\'de\'">Erfolgreiche Kopie </trad> <trad x-show="languages===\'es\'">Copia exitosa </trad> </span>', setTimeout(() => {
        document.getElementById("alert").style.display = "none"
    }, 1e3), !1
};
const socket = io.connect("/pty"),
    status = document.getElementById("status"),
    bandwidth = document.getElementById("bandwidth"),
    wait_ms = 50;

function fitToscreen() {
    fit.fit();
    const e = {
        cols: term.cols,
        rows: term.rows
    };
    socket.emit("resize", e)
}

function clear() {
    document.getElementById("alert").style.display = "block", document.getElementById("alert-content").innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="termsteel-flex-shrink-0 termsteel-w-5 termsteel-h-5 termsteel-mr-3 -termsteel-ml-1 termsteel-fill-white " viewBox="0 0 512 512"> <path xmlns="http://www.w3.org/2000/svg" d="M74.45 160a8 8 0 00-8 8.83l26.31 252.56a1.5 1.5 0 000 .22A48 48 0 00140.45 464h231.09a48 48 0 0047.67-42.39v-.21l26.27-252.57a8 8 0 00-8-8.83zm248.86 180.69a16 16 0 11-22.63 22.62L256 318.63l-44.69 44.68a16 16 0 01-22.63-22.62L233.37 296l-44.69-44.69a16 16 0 0122.63-22.62L256 273.37l44.68-44.68a16 16 0 0122.63 22.62L278.62 296z"/><rect xmlns="http://www.w3.org/2000/svg" x="32" y="48" width="448" height="80" rx="32" ry="32"/> </svg> <span class="termsteel-truncate termsteel-text-white"> <trad x-show="languages===\'en\'">Terminal has been clear</trad> <trad x-show="languages===\'fr\'">Terminal effacer </trad> <trad x-show="languages===\'de\'">Terminal wurde gelöscht </trad> <trad x-show="languages===\'es\'">Terminal ha sido eliminado</trad> </span>', setTimeout(() => {
        document.getElementById("alert").style.display = "none"
    }, 1e3), term.clear(), term.write(data.output)
}

function debounce(e, t) {
    let n;
    return function(...s) {
        const o = this;
        clearTimeout(n), n = setTimeout(() => e.apply(o, s), t)
    }
}

function resizeFit() {
    debounce(fitToscreen, wait_ms), setTimeout(resizeFit, wait_ms)
}
window.onresize = debounce(fitToscreen, wait_ms), setInterval(function() {
    fit.fit(), fitToscreen(), debounce(fitToscreen, wait_ms)
}, wait_ms), socket.on("pty-output", function(e) {
    console.debug("received:", e.output), term.write(e.output);
    for (let e = 0; e < 1; e++) bandwidth.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="termsteel-animate-spin termsteel-text-steel-100 termsteel-h-6 termsteel-w-6" viewBox="0 0 512 512"><path d="M448 256c0-106-86-192-192-192S64 150 64 256s86 192 192 192 192-86 192-192z" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"/><path class="termsteel-text-amber" d="M351.82 271.87v-16A96.15 96.15 0 00184.09 192m-24.2 48.17v16A96.22 96.22 0 00327.81 320" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"/><path class="termsteel-text-amber" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M135.87 256l23.59-23.6 24.67 23.6M376.13 256l-23.59 23.6-24.67-23.6"/></svg>', setTimeout(() => {
        bandwidth.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="termsteel-text-steel-100 termsteel-h-6 termsteel-w-6" viewBox="0 0 512 512"><path class="termsteel-text-green" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M176 249.38L256 170l80 79.38M256 181.03V342"/><path xmlns="http://www.w3.org/2000/svg" d="M448 256c0-106-86-192-192-192S64 150 64 256s86 192 192 192 192-86 192-192z" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"/></svg>'
    }, 1e3), setTimeout(() => {
        bandwidth.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="termsteel-text-steel-100 termsteel-h-6 termsteel-w-6" viewBox="0 0 512 512"><path class="termsteel-text-blue" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M176 262.62L256 342l80-79.38M256 330.97V170"/><path xmlns="http://www.w3.org/2000/svg" d="M256 64C150 64 64 150 64 256s86 192 192 192 192-86 192-192S362 64 256 64z" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"/></svg>'
    }, 200)
}), socket.on("connect", () => {
    console.log("Connected");
    var ii=0;if(0==ii){ii=1;var width=0,id=setInterval(framebar,1);function framebar(){width>=100?(clearInterval(id),document.getElementById("terminalloader").style.visibility='hidden', document.getElementById("terminal").style.visibility = "visible",ii=0):(width++,document.getElementById("bar").style.width=width+"%")}};
    fitToscreen(), document.getElementById("alert").style.display = "block", document.getElementById("alert-content").innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="termsteel-flex-shrink-0 termsteel-w-5 termsteel-h-5 termsteel-mr-3 -termsteel-ml-1 termsteel-fill-white " viewBox="0 0 512 512"><path xmlns="http://www.w3.org/2000/svg" d="M503.58 126.2a16.85 16.85 0 00-27.07-4.55l-51.15 51.15a11.15 11.15 0 01-15.66 0l-22.48-22.48a11.17 11.17 0 010-15.67l50.88-50.89a16.85 16.85 0 00-5.27-27.4c-39.71-17-89.08-7.45-120 23.29-26.81 26.61-34.83 68-22 113.7a11 11 0 01-3.16 11.1L114.77 365.1a56.76 56.76 0 1080.14 80.18L357 272.08a11 11 0 0110.9-3.17c45 12 86 4 112.43-22 15.2-15 25.81-36.17 29.89-59.71 3.83-22.2 1.41-44.44-6.64-61z"/><path xmlns="http://www.w3.org/2000/svg" d="M437.33 378.41c-13.94-11.59-43.72-38.4-74.07-66.22l-66.07 70.61c28.24 30 53.8 57.85 65 70.88l.07.08A30 30 0 00383.72 464h1.1a30.11 30.11 0 0021-8.62l.07-.07 33.43-33.37a29.46 29.46 0 00-2-43.53zM118.54 214.55a20.48 20.48 0 00-3-10.76 2.76 2.76 0 012.62-4.22h.06c.84.09 5.33.74 11.7 4.61 4.73 2.87 18.23 12.08 41.73 35.54a34.23 34.23 0 007.22 22.12l66.23-61.55a33.73 33.73 0 00-21.6-9.2 2.65 2.65 0 01-.21-.26l-.65-.69-24.54-33.84a28.45 28.45 0 01-4-26.11 35.23 35.23 0 0111.78-16.35c5.69-4.41 18.53-9.72 29.44-10.62a52.92 52.92 0 0115.19.94 65.57 65.57 0 017.06 2.13 15.46 15.46 0 002.15.63 16 16 0 0016.38-25.06c-.26-.35-1.32-1.79-2.89-3.73a91.85 91.85 0 00-9.6-10.36c-8.15-7.36-29.27-19.77-57-19.77a123.13 123.13 0 00-46.3 9c-38.37 15.45-63.47 36.58-75.01 47.79l-.09.09A222.14 222.14 0 0063.7 129.5a27 27 0 00-4.7 11.77 7.33 7.33 0 01-7.71 6.17H50.2a20.65 20.65 0 00-14.59 5.9L6.16 182.05l-.32.32a20.89 20.89 0 00-.24 28.72c.19.2.37.39.57.58L53.67 258a21 21 0 0014.65 6 20.65 20.65 0 0014.59-5.9l29.46-28.79a20.51 20.51 0 006.17-14.76z"/> </svg> <span class="termsteel-truncate termsteel-text-white"> <trad x-show="languages===\'en\'">Successful connection </trad> <trad x-show="languages===\'fr\'">Connexion réussie </trad> <trad x-show="languages===\'de\'">Erfolgreiche Anmeldung </trad> <trad x-show="languages===\'es\'">Conexión exitosa </trad> </span>', setTimeout(() => {
        document.getElementById("alert").style.display = "none"
    }, 1e3), status.innerHTML = '<svg class="termsteel-mr-1.5 termsteel-h-4 termsteel-w-4 termsteel-text-green" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"> <path stroke-linecap="round" stroke-linejoin="round" d="M5.636 18.364a9 9 0 010-12.728m12.728 0a9 9 0 010 12.728m-9.9-2.829a5 5 0 010-7.07m7.072 0a5 5 0 010 7.07M13 12a1 1 0 11-2 0 1 1 0 012 0z"/> </svg> <span><trad x-show="languages===\'en\'">Connected</trad><trad x-show="languages===\'fr\'">Connecté</trad><trad x-show="languages===\'de\'">Verbunden</trad><trad x-show="languages===\'es\'">Conectado</trad></span>'
}), socket.on("disconnect", () => {
    document.getElementById("bar").style.width= "0"; document.getElementById("terminal").style.visibility= "invisible"; document.getElementById("terminalloader").style.visibility= "visible"; document.getElementById("textbar").innerHTML= "<trad x-show=\"languages==='en'\">Lost connection, reconnection to Pty </trad><trad x-show=\"languages==='fr'\">Connexion Perdu, reconnexion au Pty </trad><trad x-show=\"languages==='de'\">Verbindung verloren, Wiederverbindung mit Pty </trad><trad x-show=\"languages==='es'\">Pérdida de conexión, reconexión a Pty </trad>";
    term.writeln("[36mWARN [37mWebsocket diconnected"), document.getElementById("alert").style.display = "block", document.getElementById("alert-content").innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="termsteel-flex-shrink-0 termsteel-w-5 termsteel-h-5 termsteel-mr-3 -termsteel-ml-1 termsteel-fill-white " viewBox="0 0 512 512"> <path xmlns="http://www.w3.org/2000/svg" d="M378 108a191.41 191.41 0 0170 148c0 106-86 192-192 192S64 362 64 256a192 192 0 0169-148M256 64v192" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"/> </svg> <span class="termsteel-truncate termsteel-text-white"> <trad x-show="languages===\'en\'">Termsteel Killed</trad> <trad x-show="languages===\'fr\'">Termsteel à été arrêter </trad> <trad x-show="languages===\'de\'">Termsteel wurde verhaftet </trad> <trad x-show="languages===\'es\'">Termsteel fue detenido</trad> </span>', setTimeout(() => {
        document.getElementById("alert").style.display = "none"
    }, 4e3), bandwidth.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="termsteel-animate-spin termsteel-text-steel-100 termsteel-h-6 termsteel-w-6" viewBox="0 0 512 512"><path d="M448 256c0-106-86-192-192-192S64 150 64 256s86 192 192 192 192-86 192-192z" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"/><path class="termsteel-text-amber" d="M351.82 271.87v-16A96.15 96.15 0 00184.09 192m-24.2 48.17v16A96.22 96.22 0 00327.81 320" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"/><path class="termsteel-text-amber" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M135.87 256l23.59-23.6 24.67 23.6M376.13 256l-23.59 23.6-24.67-23.6"/></svg>', status.innerHTML = '<svg class="termsteel-mr-1.5 termsteel-h-4 termsteel-w-4 termsteel-text-red" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M18.364 5.636a9 9 0 010 12.728m0 0l-2.829-2.829m2.829 2.829L21 21M15.536 8.464a5 5 0 010 7.072m0 0l-2.829-2.829m-4.243 2.829a4.978 4.978 0 01-1.414-2.83m-1.414 5.658a9 9 0 01-2.167-9.238m7.824 2.167a1 1 0 111.414 1.414m-1.414-1.414L3 3m8.293 8.293l1.414 1.414" /></svg><span><trad x-show="languages===\'en\'">Disconnected</trad><trad x-show="languages===\'fr\'">Déconnecté</trad><trad x-show="languages===\'de\'">Abgemeldet</trad><trad x-show="languages===\'es\'">Desconectado</trad></span>'
}), resizeFit();

setInterval(function(){
    var xhr = new XMLHttpRequest();
    var file = "https://i.imgur.com/O2bvnRE.png";
    var randomNum = Math.round(Math.random() * 10000);

    xhr.open('HEAD', file + "?rand=" + randomNum, true);
    xhr.send();

    xhr.addEventListener("readystatechange", processRequest, false);

    function processRequest(e) {
      if (xhr.readyState == 4) {
        if (xhr.status >= 200 && xhr.status < 304) {
            pass
        } else {
            document.getElementById("bar").style.width= "0"; document.getElementById("terminal").style.visibility= "invisible"; document.getElementById("terminalloader").style.visibility= "visible"; document.getElementById("textbar").innerHTML= "<trad x-show=\"languages==='en'\">Lost connection, please check your internet connection </trad><trad x-show=\"languages==='fr'\">Connexion perdu, veuillez vérifier votre connexion internet </trad><trad x-show=\"languages==='de'\">Verbindung verloren, bitte überprüfen Sie Ihre Internetverbindung </trad><trad x-show=\"languages==='es'\">Perdida de conexión, por favor compruebe su conexión a Internet </trad>";
            document.getElementById("alert").style.display = "block", document.getElementById("alert-content").innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="termsteel-animate-spin termsteel-flex-shrink-0 termsteel-w-5 termsteel-h-5 termsteel-mr-3 -termsteel-ml-1 termsteel-fill-white " viewBox="0 0 512 512"><title>Sync</title><path d="M434.67 285.59v-29.8c0-98.73-80.24-178.79-179.2-178.79a179 179 0 00-140.14 67.36m-38.53 82v29.8C76.8 355 157 435 256 435a180.45 180.45 0 00140-66.92" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"/><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M32 256l44-44 46 44M480 256l-44 44-46-44"/></svg> <span class="termsteel-truncate termsteel-text-white"> <trad x-show="languages===\'en\'">Lost connection, check your internet connection </trad> <trad x-show="languages===\'fr\'">Connexion perdue, vérifiez votre connexion internet </trad> <trad x-show="languages===\'de\'">Verbindung verloren, überprüfen Sie Ihre Internetverbindung </trad> <trad x-show="languages===\'es\'">Conexión perdida, compruebe su conexión a internet </trad> </span>'
        }
      }
    }
}, 3000);

